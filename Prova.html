<html>
	<canvas id="backgroundCanvas" width="600" height="600" style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
	<canvas id="mapaCanvas" width="600" height="600" style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
	<canvas id="heroiCanvas" width="600" height="600" style="position: absolute; left: 0; top: 0; z-index: 2;"></canvas>

<!--el style es CSS i el z-index defineix en quina posicio esta el canvas, com mes alt, mes endevant esta (per sobre dels altres)-->

	<script src="Quadrat.js" type="text/javascript"></script>

	<script type="text/javascript">

		var WIDTH = 600;
		var HEIGHT = 600;
		var backgroundCanvas;
		var mapaCanvas;
		var heroiCanvas;
		var ctxb; //context del background
		var ctxm; //context del mapa
		var ctxh; //context de l'heroi
		var MIDAQUADRAT = 15;
		var DELTAPOS = 2; //Augment de la posicio cada interval si esta clicant
		var posX = 0;
		var posY = 0;
		var keyState = {};

		window.onload = function() {
			backgroundCanvas = document.getElementById('backgroundCanvas');
			mapaCanvas = document.getElementById('mapaCanvas');
			heroiCanvas = document.getElementById('heroiCanvas');
			ctxb = backgroundCanvas.getContext('2d');
			ctxm = mapaCanvas.getContext('2d');
			ctxh = heroiCanvas.getContext('2d');

			const backgroundimg = new Image();
			backgroundimg.src = "https://images.designtrends.com/wp-content/uploads/2016/04/11094936/White-and-Grey-Grid-Pattern.jpg";
			backgroundimg.onload = function() {ctxb.drawImage(backgroundimg,0,0,backgroundCanvas.width,backgroundCanvas.height);}
			//es necessita el onload pq si no a vegades s'executa el drawImage() sense que es carregui
			//la imatge i llavors no surt res pq no es torna a cridar drawImage()
			ctxh.fillStyle = 'blue'; //aixo es del canvas de l'heroi pq vegis com es borra quan mous l'heroi
			ctxh.fillRect(0,0,100,600);
			ctxm.fillStyle = 'black'; //aixo es del context del mapa pq vegis com NO es borra
			ctxm.fillRect(0,0,600,100);

			ctxh.fillStyle = 'red'; //el fillStyle es defineix un cop i aixi no cal fer-ho a cada iteracio (no canvia)

			heroi = new Quadrat(posX, posY);
			gameLoop();
		}

		function gameLoop() {
		    drawEverything();
		    mouTot();
		    setTimeout(gameLoop, 10);
		}

		//MOU TOT

		function mouTot() {
			mouQuadrat();
		}

		//CALCUL POSICIO QUADRAT

		//https://stackoverflow.com/questions/12273451/how-to-fix-delay-in-javascript-keydown
		window.addEventListener('keydown',function(e){
    		keyState[e.keyCode || e.which] = true;
		},true);
		window.addEventListener('keyup',function(e){
   	 		keyState[e.keyCode || e.which] = false;
		},true);

		function mouQuadrat() {
			if (keyState[37]) heroi.x = heroi.x - DELTAPOS;
			if (keyState[38]) heroi.y = heroi.y - DELTAPOS;
			if (keyState[39]) heroi.x = heroi.x + DELTAPOS;
			if (keyState[40]) heroi.y = heroi.y + DELTAPOS;
		}

		//DIBUIX DEL CANVAS
		function drawEverything() {
			heroi.dibuix();
		}

		function colorRect(posX, posY, width, height) {
			ctxh.clearRect(posX - MIDAQUADRAT/2, posY - MIDAQUADRAT/2, 30, 30);
			// lo de -MIDAQUADRAT/2 es per fer que es borri millor
   		ctxh.fillRect(posX, posY, width, height);
		}

	</script>

</html>
